{"version":3,"file":"patch-worker.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://prompt-gpt/./src/foreground/patch-worker.js"],"sourcesContent":["/*\nCopyright 2013 Rob Wu <gwnRob@gmail.com>\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// Target: Chrome 20+\n\n// W3-compliant Worker proxy.\n// This module replaces the global Worker object.\n// When invoked, the default Worker object is called.\n// If this call fails with SECURITY_ERR, the script is fetched\n//  using async XHR, and transparently proxies all calls and\n//  setters/getters to the new Worker object.\n// Note: This script does not magically circumvent the Same origin policy.\n\n(function() {\n    'use strict';\n    var Worker_ = window.Worker;\n    var URL = window.URL || window.webkitURL;\n    // Create dummy worker for the following purposes:\n    // 1. Don't override the global Worker object if the fallback isn't\n    //    going to work (future API changes?)\n    // 2. Use it to trigger early validation of postMessage calls\n    // Note: Blob constructor is supported since Chrome 20, but since\n    // some of the used Chrome APIs are only supported as of Chrome 20,\n    //  I don't bother adding a BlobBuilder fallback.\n    var dummyWorker = new Worker_(\n        URL.createObjectURL(new Blob([], {type: 'text/javascript'})));\n    window.Worker = function Worker(scriptURL) {\n      if (arguments.length === 0) {\n        throw new TypeError('Not enough arguments');\n      }\n      try {\n        return new Worker_(scriptURL);\n      } catch (e) {\n        if (e.code === 18/*DOMException.SECURITY_ERR*/) {\n          return new WorkerXHR(scriptURL);\n        } else {\n          throw e;\n        }\n      }\n    };\n    // Bind events and replay queued messages\n    function bindWorker(worker, workerURL) {\n      if (worker._terminated) {\n        return;\n      }\n      worker.Worker = new Worker_(workerURL);\n      worker.Worker.onerror = worker._onerror;\n      worker.Worker.onmessage = worker._onmessage;\n      var o;\n      while ( (o = worker._replayQueue.shift()) ) {\n        worker.Worker[o.method].apply(worker.Worker, o.arguments);\n      }\n      while ( (o = worker._messageQueue.shift()) ) {\n        worker.Worker.postMessage.apply(worker.Worker, o);\n      }\n    }\n    function WorkerXHR(scriptURL) {\n      var worker = this;\n      var x = new XMLHttpRequest();\n      x.responseType = 'blob';\n      x.onload = function() {\n        // http://stackoverflow.com/a/10372280/938089\n        var workerURL = URL.createObjectURL(x.response);\n        bindWorker(worker, workerURL);\n      };\n      x.open('GET', scriptURL);\n      x.send();\n      worker._replayQueue = [];\n      worker._messageQueue = [];\n    }\n    WorkerXHR.prototype = {\n      constructor: Worker_,\n      terminate: function() {\n        if (!this._terminated) {\n          this._terminated = true;\n          if (this.Worker)\n            this.Worker.terminate();\n        }\n      },\n      postMessage: function(message, transfer) {\n        if (!(this instanceof WorkerXHR))\n          throw new TypeError('Illegal invocation');\n        if (this.Worker) {\n          this.Worker.postMessage.apply(this.Worker, arguments);\n        } else {\n          // Trigger validation:\n          dummyWorker.postMessage(message);\n          // Alright, push the valid message to the queue.\n          this._messageQueue.push(arguments);\n        }\n      }\n    };\n    // Implement the EventTarget interface\n    [\n      'addEventListener',\n      'removeEventListener',\n      'dispatchEvent'\n    ].forEach(function(method) {\n      WorkerXHR.prototype[method] = function() {\n        if (!(this instanceof WorkerXHR)) {\n          throw new TypeError('Illegal invocation');\n        }\n        if (this.Worker) {\n          this.Worker[method].apply(this.Worker, arguments);\n        } else {\n          this._replayQueue.push({method: method, arguments: arguments});\n        }\n      };\n    });\n    Object.defineProperties(WorkerXHR.prototype, {\n      onmessage: {\n        get: function() {return this._onmessage || null;},\n        set: function(func) {\n          this._onmessage = typeof func === 'function' ? func : null;\n        }\n      },\n      onerror: {\n        get: function() {return this._onerror || null;},\n        set: function(func) {\n          this._onerror = typeof func === 'function' ? func : null;\n        }\n      }\n    });\n  })();"],"names":[],"sourceRoot":""}